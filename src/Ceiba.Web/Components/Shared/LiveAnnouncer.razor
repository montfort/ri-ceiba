@* Live region for screen reader announcements (WCAG 4.1.3) *@
@implements IDisposable

<div id="live-announcer"
     class="visually-hidden"
     aria-live="@(Politeness)"
     aria-atomic="true"
     role="status">
    @_message
</div>

@code {
    [Parameter]
    public string Politeness { get; set; } = "polite";

    private string _message = string.Empty;

    // Static instance for global access - intentional singleton pattern for accessibility announcements
    // This is a deliberate singleton pattern for screen reader announcements (WCAG 4.1.3)
    // S2696 is suppressed because we need to update the static field from instance methods
    // to maintain a single active announcer for the entire application
#pragma warning disable S2696 // Instance members should not write to "static" fields
    private static LiveAnnouncer? _instance;

    protected override void OnInitialized()
    {
        _instance = this;
    }

    public static void Announce(string message)
    {
        if (_instance != null)
        {
            _instance._message = string.Empty;
            _instance.StateHasChanged();

            // Small delay to ensure screen readers pick up the change
            Task.Delay(100).ContinueWith(_ =>
            {
                _instance._message = message;
                _instance.InvokeAsync(_instance.StateHasChanged);
            });
        }
    }

    public void Dispose()
    {
        if (_instance == this)
        {
            _instance = null;
        }
    }
#pragma warning restore S2696
}
